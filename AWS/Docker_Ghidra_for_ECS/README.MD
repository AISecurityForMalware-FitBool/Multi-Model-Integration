# Docker_Ghidra_for_ECS

> **Fit-Bool AI Malware Analysis System**  
> Ghidra 기반 **악성코드 분석 자동화 환경 (ECS용 Docker 이미지)**

이 디렉터리는 AWS ECS 환경에서 Ghidra를 Headless 모드로 실행하여  
악성코드의 **Opcode / ASM 코드**를 자동 추출하기 위한 컨테이너 이미지를 구성합니다.

---

## Directory Structure


Docker_Ghidra_for_ECS/
│
├── Dockerfile               # Fargate용 Docker 이미지 정의 파일 (ENTRYPOINT 없음)
├── run_one.sh               # 컨테이너 실행 시 자동으로 수행되는 셸 스크립트
│
├── lambda_function.py       # Lambda에서 ECS Task를 실행하기 위한 스크립트
│
├── scripts/
│   └── export_asm.py        # Ghidra 내부에서 동작하며 ASM 추출을 수행
│
└── ghidra_11.4.2_PUBLIC/    # Ghidra 본체 디렉터리 (공식 배포 버전)
Purpose
이 모듈은 Ghidra 분석 기능을 AWS ECS Fargate 컨테이너 환경으로 분리하여
Lambda에서 직접 실행 가능한 형태로 제공합니다.

실행 파일(PE)을 Ghidra Headless 모드로 분석

함수 단위로 Opcode / ASM 추출

결과를 AWS S3 (AI_Result/OPC/)에 저장

이후 Final_Ensemble 및 Final_LLM Lambda로 전달되어
결과 통합 및 보고서 생성에 사용됩니다.

--- 

# Local Build & Run
## PowerShell

### 1️빌드
docker build -t ghidra-headless:local .

### 2️행 (input/output 디렉토리 마운트)
docker run --rm -v ${PWD}\input:/input:ro -v ${PWD}\output:/output ghidra-headless:local
    **AWS ECS 배포 절차**

**1. Docker 이미지 빌드**

docker build -t ghidra-aws:latest .

**2. ECR 로그인**
aws ecr get-login-password --region ap-northeast-2 \
| docker login --username AWS --password-stdin <AWS_ACCOUNT_ID>.dkr.ecr.ap-northeast-2.amazonaws.com

**3. 이미지 태깅 및 푸시**
docker tag ghidra-aws:latest <AWS_ACCOUNT_ID>.dkr.ecr.ap-northeast-2.amazonaws.com/ghidra-aws:latest
docker push <AWS_ACCOUNT_ID>.dkr.ecr.ap-northeast-2.amazonaws.com/ghidra-aws:latest

**4. ECS 클러스터 및 Task 정의**
Cluster Name: ghidra

Task Role: S3 접근 (s3:GetObject, s3:PutObject)

네트워크 설정: Subnet + SecurityGroup 포함

실행 트리거: OPC_Lambda_1 → RunTask() 호출

---

# Output Example (ASM Format)

; Program : sample.exe
; Lang    : x86:LE:64:default
; AddrSz  : 8
; --- auto-generated by export_asm.py ---

; ===== Function FUN_00401000 @ 00401000 =====
00401000: 48 53                    PUSH RBX
00401002: 55                       PUSH RBP
00401003: 56                       PUSH RSI
00401004: 57                       PUSH RDI
00401005: 41 54                    PUSH R12
00401007: 41 55                    PUSH R13
00401009: 41 56                    PUSH R14
0040100b: 41 57                    PUSH R15
0040100d: 48 83 EC 28              SUB RSP, 0x28
00401011: 48 8B 02                 MOV RAX, qword ptr [RDX]
...

---

# Notes
ECS Task Role에는 S3 및 CloudWatch 접근 권한이 반드시 포함되어야 합니다.

lambda_function.py는 Lambda에서 ECS Task를 자동 실행하는 핵심 스크립트입니다.

export_asm.py는 Ghidra 내부에서 함수 단위로 opcode를 추출합니다.

출력된 .asm 파일은 AI 학습용 Opcode Feature 생성에 사용됩니다.